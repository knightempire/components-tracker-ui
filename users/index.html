<!DOCTYPE html>
<html lang="en">

<head>
    <title>Amuda - Dashboard </title>
    <!-- [Meta] -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <script src="https://cdn.tailwindcss.com"></script>


    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" id="main-font-link">

    <link rel="stylesheet" href="../assets/fonts/tabler-icons.min.css">
  
    <link rel="stylesheet" href="../assets/fonts/feather.css">
    <!-- [Font Awesome Icons] https://fontawesome.com/icons -->
    <link rel="stylesheet" href="../assets/fonts/fontawesome.css">
    <!-- [Material Icons] https://fonts.google.com/icons -->
    <link rel="stylesheet" href="../assets/fonts/material.css">
    <!-- [Template CSS Files] -->
    <link rel="stylesheet" href="../assets/css/style.css" id="main-style-link">
    <link rel="stylesheet" href="../assets/css/style-preset.css">
    <link rel="stylesheet" href="./css/main.css">
    <script src="./js/main.js"></script>
</head>
<!-- [Head] end -->
<!-- [Body] Start -->

<body>
    <!-- [ Pre-loader ] start -->
    <div class="loader-bg">
        <div class="loader-track">
            <div class="loader-fill"></div>
        </div>
    </div>
    <!-- [ Pre-loader ] End -->
    <!-- [ Sidebar Menu ] start -->
    <nav class="pc-sidebar">
        <div class="navbar-wrapper">
            <div class="m-header">
                <a href="../dashboard/index.html" class="b-brand text-primary">
                    <!-- ========   Change your logo from here   ============ -->
                    LAB
                </a>
            </div>
            <div class="navbar-content">
                <ul class="pc-navbar">

                    <li class="pc-item">
                        <a href="./index.html" class="pc-link"><span class="pc-micon"><i class="ti ti-dashboard"></i></span><span
              class="pc-mtext">Default</span></a>
                    </li>



                    <li class="pc-item">
                        <a href="./orders.html" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-tool"></i></span>
                            <span class="pc-mtext">Orders</span>
                        </a>
                    </li>


                </ul>

            </div>
        </div>
    </nav>
    <!-- [ Sidebar Menu ] end -->
    <!-- [ Header Topbar ] start -->
    <header class="pc-header">
        <div class="header-wrapper">
            <!-- [Mobile Media Block] start -->
            <div class="me-auto pc-mob-drp">
                <ul class="list-unstyled">
                    <li class="pc-h-item header-mobile-collapse">
                        <a href="#" class="pc-head-link head-link-secondary ms-0" id="sidebar-hide">
                            <i class="ti ti-menu-2"></i>
                        </a>
                    </li>
                    <li class="pc-h-item pc-sidebar-popup">
                        <a href="#" class="pc-head-link head-link-secondary ms-0" id="mobile-collapse">
                            <i class="ti ti-menu-2"></i>
                        </a>
                    </li>

                    <li class="pc-h-item d-none d-md-inline-flex">
                        <h3>Hello admin</h3>
                    </li>
                </ul>
            </div>
            <!-- [Mobile Media Block end] -->
            <div class="ms-auto">
                <ul class="list-unstyled">

                    <li class="dropdown pc-h-item header-user-profile">
                        <a class="pc-head-link head-link-primary dropdown-toggle arrow-none me-0" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                          Logout

                        </a>

                    </li>
                </ul>
            </div>
        </div>
    </header>
    <!-- [ Header ] end -->



    <!-- [ Main Content ] start -->
    <div class="pc-container">
        <div class="pc-content">
            <!-- [ Main Content ] start -->

            <div class="main" id="main">

                <div class="row">
                    <!-- [ sample-page ] start -->

                    <!-- Card 1 -->
                    <div class="col-xl-3 col-md-6">
                        <div class="card dashnum-card dashnum-card-small overflow-hidden">
                            <span class="round bg-primary small"></span>
                            <span class="round bg-primary big"></span>
                            <div class="card-body p-3">
                                <div class="d-flex align-items-center">
                                    <div class="avtar avtar-lg bg-light-primary">
                                        <i class="text-primary ti ti-wallet"></i>
                                    </div>
                                    <div class="ms-2">
                                        <h4 class="mb-1" id="displaytotalcomponents">$550K <i class="ti ti-arrow-up-right-circle opacity-50"></i></h4>
                                        <p class="mb-0 opacity-50 text-md">Components Availability </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Card 2 -->
                    <div class="col-xl-3 col-md-6">
                        <div class="card dashnum-card dashnum-card-small overflow-hidden">
                            <span class="round bg-warning small"></span>
                            <span class="round bg-warning big"></span>
                            <div class="card-body p-3">
                                <div class="d-flex align-items-center">
                                    <div class="avtar avtar-lg bg-light-warning">
                                        <i class="text-warning ti ti-credit-card"></i>
                                    </div>
                                    <div class="ms-2">
                                        <h4 class="mb-1" id="displaytotaloutofstock">$550K <i class="ti ti-arrow-up-right-circle opacity-50"></i></h4>
                                        <p class="mb-0 opacity-50 text-md"> Components Out of stock </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>




                    <!-- [ sample-page ] end -->
                </div>

                <div class="flex justify-center items-center hidden" id="msgok">
                    <div class="flex flex-col gap-2 w-60 sm:w-72 text-[10px] sm:text-xs z-50">
                        <div class="success-alert cursor-default flex items-center justify-between w-full h-12 sm:h-14 rounded-lg bg-[#232531] px-[10px]">
                            <div class="flex gap-2">
                                <div class="text-[#2b9875] bg-white/5 backdrop-blur-xl p-1 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path>
                                </svg>
                                </div>
                                <div>
                                    <p class="text-white"> successfully :)</p>
                                    <p class="text-gray-500" id="Msg">Product added</p>
                                </div>
                            </div>
                            <button class="text-gray-600 text-gray-600 hover:bg-white/5 p-1 rounded-md transition-colors ease-linear">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                        </div>
                    </div>
                </div>

                <div class="flex justify-center items-center flex-col gap-2  text-[10px] hidden" id="msgfail">
                    <div class="error-alert cursor-default flex items-center justify-between w-full h-12 sm:h-14 rounded-lg bg-[#232531] px-[10px]">
                        <div class="flex gap-2">
                            <div class="text-[#d65563] bg-white/5 backdrop-blur-xl p-1 rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z"
                                ></path>
                            </svg>
                            </div>
                            <div>
                                <p class="text-white">Please try again</p>
                                <p class="text-gray-500" id="Msgerr">This is the description part</p>
                            </div>
                        </div>
                        <button class="text-gray-600 hover:bg-white/10 p-1 rounded-md transition-colors ease-linear">
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke-width="1.5"
                          stroke="currentColor"
                          class="w-6 h-6"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6 18 18 6M6 6l12 12"
                          ></path>
                        </svg>
                    </button>
                    </div>
                </div>

                <div class="mainscreen" id="mainscreen">
                    <div class="row mt-4">
                        <div class="col-xl-12">
                            <div class="card">
                                <div class="card-header flex flex-col sm:flex-row sm:justify-between sm:items-center">
                                    <!-- Title and Search Bar within the same flex container -->
                                    <div class="flex w-full items-center sm:w-auto sm:mr-4">
                                        <!-- Title as a div (stays on the left) -->
                                        <div class="text-3xl font-bold sm:mr-4">Products list</div>
                                    </div>

                                    <!-- Search Bar (Stacked below on small screens) -->
                                    <div class="relative sm:w-64 w-full">
                                        <!-- Feather Search Icon and Input -->
                                        <i data-feather="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                                        <input id="searchInput" type="search" class="pl-10 pr-4 py-2 border border-black rounded-lg shadow-none focus:outline-none w-full" placeholder="Search by Roll No or Name...">
                                    </div>

                                </div>

                                <div class="card-body">
                                    <!-- Add a wrapper div to make the table scrollable on smaller screens -->
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-blue-100">
                                                <tr>
                                                    <th scope="col" class="px-6 py-3 text-left text-md font-medium text-gray-500 uppercase tracking-wider">
                                                        Name
                                                    </th>
                                                    <th scope="col" class="px-6 py-3 text-left text-md font-medium text-gray-500 uppercase tracking-wider">
                                                        Availability
                                                    </th>

                                                    <th scope="col" class="px-6 py-3 text-left text-md font-medium text-gray-500 uppercase tracking-wider">
                                                        Actions
                                                    </th>
                                                </tr>
                                            </thead>

                                            <tbody class="bg-white divide-y divide-gray-200" id="displayproducts">

                                            </tbody>
                                        </table>
                                    </div>




                                </div>




                                <div id="cart-icon" class="absolute bottom-0 right-4 bg-gray-200 text-gray-800 p-3 rounded-full shadow-md border border-gray-300 cursor-pointer hover:bg-gray-400 hidden" onclick="toggleCart()">
                                    <i data-feather="shopping-cart"></i>
                                </div>




                            </div>
                        </div>

                    </div>


                </div>



            </div>


            <div class="dispaycard shadow hidden" id="dispaycard">


                <div class="form card mt-4 p-6 ">
                    <form id="updateForm">
                        <button type="button" onclick="dispaycard()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>

                        <!-- Heading for Issue Details -->
                        <h2 class="text-2xl font-semibold text-gray-800 mb-4">Order confirmation</h2>

                        <!-- Issue Details Form -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

                            <!-- Row 1: Name, Roll No, Phone -->

                            <div class="flex flex-col">
                                <label class="font-semibold text-gray-700">Total Components:</label>
                                <div id="total_components" class="mt-1 text-gray-600">10</div>
                            </div>

                            <div class="flex flex-col">
                                <label class="font-semibold text-gray-700">requesting date:</label>
                                <div id="req_time" class="mt-1 text-gray-600">01/01/2025</div>
                            </div>
                            <div class="flex flex-col">
                                <label class="font-semibold text-gray-700">Expires Date:</label>
                                <div id="exp_time" class="mt-1 text-gray-600">01/02/2025</div>
                            </div>




                        </div>



                        <br>

                        <div class="mt-6 md:mt-10 text-left font-bold text-3xl font-bold md:text-xl">Components</div>

                        <div class="flex flex-col mt-4 lg:w-1/2">
                            <div class="-m-1.5 overflow-x-auto">
                                <div class="p-1.5 min-w-full inline-block align-middle">
                                    <div class="border rounded-lg  overflow-hidden">
                                        <table id="returnTable" class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-gray-100">
                                                <tr>
                                                    <th class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Component Name</th>
                                                    <th class="px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase">Count</th>
                                                </tr>
                                            </thead>
                                            <tbody id="returnTableBody" class="divide-y divide-gray-200">

                                                <tr>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800">Example Component</td>
                                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800">10</td>
                                                </tr>
                                                <!-- More dynamic rows will go here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <br><br>

                        <!-- Issue Details Form -->
                        <div class="mt-6 md:mt-10 text-left font-bold text-3xl font-bold md:text-xl">Profile</div>
                        <div class="grid grid-cols-1 md:grid-cols-2  mt-4 lg:grid-cols-3 gap-6">




                            <div class="flex flex-col">
                                <label class="font-semibold text-gray-700">Roll no</label>
                                <div class="flex items-center">
                                    <input type="text" id="check_roll_no" class="p-2 border rounded text-gray-600 w-2/3" placeholder="Enter Roll No">
                                    <button type="button" class="cursor-pointer rounded-lg bg-sky-400 px-6 py-2 sm:py-3 text-md font-semibold text-white ml-4" id="checkuser" onclick="checkrollno()">Check user</button>
                                </div>
                                <div id="errorname" class="mt-1 text-left text-red-600"></div>
                            </div>

                            <br>


                            <div class="flex flex-col userdetails ">
                            </div>

                            <div class="flex flex-col userdetails hidden" id="userNameDiv">
                                <label class="font-semibold text-gray-700">Name</label>
                                <div id="display_name" class="mt-1 text-gray-600"></div>
                            </div>
                            <div class="flex flex-col userdetails hidden" id="userPhoneDiv">
                                <label class="font-semibold text-gray-700">Phone</label>
                                <div id="display_roll_no" class="mt-1 text-gray-600"></div>
                            </div>
                            <div class="flex flex-col userdetails hidden" id="userFacultyDiv">
                                <label class="font-semibold text-gray-700">User Type</label>
                                <div id="display_faculty" class="mt-1 text-gray-600"></div>
                            </div>


                            <div class="flex items-center hidden" id="acknowledgmentDiv">
                                <input type="checkbox" id="acknowledgment" class="mr-2" required>
                                <label for="acknowledgment" class="text-gray-700">Acknowledgment</label>
                            </div>

                        </div>
                        <!-- Edit, Save, Back Buttons -->
                        <br>
                        <div class="text-center mt-6">
                            <button type="button" class="cursor-pointer rounded-lg bg-purple-600 px-6 py-2 sm:py-3 text-md font-semibold text-white mr-4" id="saveButton" onclick="submitForm()">Submit</button>
                        </div>
                    </form>
                </div>
            </div>

            <br>
            <!-- Include Feather Icons -->
            <script src="https://unpkg.com/feather-icons"></script>
            <script>
                feather.replace(); // Initializes the Feather Icons
            </script>




            <!-- [ Main Content ] end -->
        </div>
    </div>
    <!-- [ Main Content ] end -->
    <footer class="pc-footer">
        <div class="footer-wrapper container-fluid">
            <div class="row">
                <div class="col-sm-6 my-1">
                    <p class="m-0">Components tracker &#9829; crafted by Team <a href="https://themeforest.net/user/Team_name" target="_blank">Team_name</a></p>
                </div>
                <div class="col-sm-6 ms-auto my-1">
                    <ul class="list-inline footer-link mb-0 justify-content-sm-end d-flex">
                        <li class="list-inline-item"><a href="../index.html">Home</a></li>
                        <li class="list-inline-item"><a href="https://Team_name.gitbook.io/Components tracker-bootstrap/" target="_blank">Documentation</a></li>
                        <li class="list-inline-item"><a href="https://Team_name.support-hub.io/" target="_blank">Support</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <!-- Required Js -->
    <script src="../assets/js/plugins/popper.min.js"></script>
    <script src="../assets/js/plugins/simplebar.min.js"></script>
    <script src="../assets/js/plugins/bootstrap.min.js"></script>
    <script src="../assets/js/fonts/custom-font.js"></script>
    <script src="../assets/js/pcoded.js"></script>
    <script src="../assets/js/plugins/feather.min.js"></script>





    <script>
        layout_change('light');
    </script>




    <script>
        font_change("Roboto");
    </script>


    <script>
        change_box_container('false');
    </script>


    <script>
        layout_caption_change('true');
    </script>




    <script>
        layout_rtl_change('false');
    </script>


    <script>
        preset_change("preset-1");
    </script>



</body>
<!-- [Body] end -->

</html>



<script>
    let params = {};

    displayProducts();

    async function displayProducts() {
        try {
            const response = await fetch('http://localhost:3002/api/product/products-list', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
            });

            if (!response.ok) {
                const errorMessage = await response.text();
                throw new Error(`Error ${response.status}: ${errorMessage}`);
            }

            const data = await response.json();

            if (data.success && Array.isArray(data.products)) {
                let totalComponents = 0;
                let totalOutOfStock = 0;

                const displayProductsTable = document.getElementById('displayproducts');
                displayProductsTable.innerHTML = '';

                const searchInput = document.getElementById('searchInput');

                searchInput.addEventListener('input', () => {
                    const searchTerm = searchInput.value.toLowerCase();
                    const filteredProducts = data.products.filter(product => {
                        return product.product_name.toLowerCase().includes(searchTerm);
                    });

                    updateTable(filteredProducts);
                });

                function updateTable(products) {
                    displayProductsTable.innerHTML = '';

                    products.forEach((product, index) => {
                        const row = document.createElement('tr');

                        const cellProductName = document.createElement('td');
                        cellProductName.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-md', 'text-gray-900');
                        cellProductName.textContent = product.product_name;
                        row.appendChild(cellProductName);

                        const cellInCount = document.createElement('td');
                        cellInCount.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-md', 'text-gray-900');
                        cellInCount.textContent = product.in_count;
                        row.appendChild(cellInCount);

                        const cellActions = document.createElement('td');
                        cellActions.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-sm', 'font-medium');
                        cellActions.style.width = "300px";

                        cellActions.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div id="add-button-container-${index}" class="flex justify-start">
                            <button
                                onClick="handleAdd(${index})"
                                id="add-button-${index}"
                                class="px-4 py-2 bg-purple-500 text-white font-bold rounded-md hover:bg-purple-400"
                            >
                                Add
                            </button>
                        </div>
                        <div id="quantity-display-${index}" class="hidden flex items-center space-x-2">
                            <button
                                onClick="handleQuantityChange(${index}, 'decrement')"
                                class="text-sm text-white bg-blue-400 px-4 py-2 rounded-md hover:bg-blue-500"
                            >
                                -
                            </button>
                            <span id="quantity-${index}" class="text-lg text-gray-900 font-semibold">1</span>
                            <button
                                onClick="handleQuantityChange(${index}, 'increment')"
                                class="text-sm text-white bg-blue-400 px-4 py-2 rounded-md hover:bg-blue-500"
                            >
                                +
                            </button>
                        </div>
                    </div>
                `;
                        row.appendChild(cellActions);

                        displayProductsTable.appendChild(row);

                        totalComponents += product.in_count + product.out_count;
                        if (product.in_count === 0) {
                            totalOutOfStock += 1;
                        }
                    });

                    document.getElementById('displaytotalcomponents').textContent = `${totalComponents}`;
                    document.getElementById('displaytotaloutofstock').textContent = totalOutOfStock;
                }

                window.handleAdd = (index) => {
                    console.log(`Add button clicked for index: ${index}`);
                    const addButton = document.querySelector(`#add-button-${index}`);
                    const quantityDisplay = document.querySelector(`#quantity-display-${index}`);
                    const cartIcon = document.getElementById('cart-icon');

                    addButton.classList.add('hidden');
                    quantityDisplay.classList.remove('hidden');

                    document.querySelector(`#quantity-${index}`).textContent = '1';

                    const product = data.products[index];
                    const productId = product.product_id;
                    const productName = product.product_name;

                    // Store product_id, product_name, and quantity in params
                    params[productId] = {
                        productName,
                        quantity: 1
                    };

                    // Show the cart icon if there are any items in the cart
                    updateCartIconVisibility();

                    console.log(params);

                    // Update the return table
                    updateReturnTable();
                };

                window.handleQuantityChange = (index, action) => {
                    const quantityDisplay = document.querySelector(`#quantity-display-${index}`);
                    const quantitySpan = document.querySelector(`#quantity-${index}`);
                    let currentQuantity = parseInt(quantitySpan.textContent, 10);

                    const availableStock = data.products[index].in_count;

                    if (action === 'increment' && currentQuantity < availableStock) {
                        currentQuantity++;
                    } else if (action === 'decrement') {
                        currentQuantity--;
                    }

                    quantitySpan.textContent = currentQuantity;

                    const productId = data.products[index].product_id;
                    const productName = data.products[index].product_name;

                    if (currentQuantity > 0) {
                        params[productId] = {
                            productName,
                            quantity: currentQuantity
                        };
                    } else {
                        delete params[productId];
                    }

                    // Update cart icon visibility after quantity change
                    updateCartIconVisibility();

                    console.log(params);

                    // Update the return table
                    updateReturnTable();

                    if (currentQuantity === 0) {
                        const addButton = document.querySelector(`#add-button-${index}`);
                        addButton.classList.remove('hidden');
                        quantityDisplay.classList.add('hidden');
                    }
                };

                // Update cart icon visibility
                function updateCartIconVisibility() {
                    const cartIcon = document.getElementById('cart-icon');

                    // Show the cart icon if there are any items in the cart (params is not empty)
                    if (Object.keys(params).length > 0) {
                        cartIcon.classList.remove('hidden');
                    } else {
                        cartIcon.classList.add('hidden');
                    }
                }

                // Function to update the return table with selected products
                function updateReturnTable() {
                    const returnTableBody = document.getElementById('returnTableBody');
                    returnTableBody.innerHTML = ''; // Clear previous rows

                    Object.values(params).forEach(item => {
                        const row = document.createElement('tr');

                        const cellProductName = document.createElement('td');
                        cellProductName.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-md', 'text-gray-900');
                        cellProductName.textContent = item.productName;
                        row.appendChild(cellProductName);

                        const cellQuantity = document.createElement('td');
                        cellQuantity.classList.add('px-6', 'py-4', 'whitespace-nowrap', 'text-md', 'text-gray-900');
                        cellQuantity.textContent = item.quantity;
                        row.appendChild(cellQuantity);

                        returnTableBody.appendChild(row);
                    });
                }

                updateTable(data.products);

            } else {
                const displayProductsTable = document.getElementById('displayproducts');
                displayProductsTable.innerHTML = '<tr><td colspan="7" class="px-6 py-4 text-center text-red-500">No products available</td></tr>';
            }
        } catch (error) {
            console.error("Error fetching products:", error);
            const displayProductsTable = document.getElementById('displayproducts');
            displayProductsTable.innerHTML = '<tr><td colspan="7" class="px-6 py-4 text-center text-red-500">Failed to fetch products.</td></tr>';
        }
    }


    function toggleCart() {

        dispaycard();

        const currentDate = new Date().toLocaleString("en-IN", {
            timeZone: "Asia/Kolkata"
        });

        console.log('Current Date and Time in Asia/Kolkata:', currentDate);

        const cartItems = Object.values(params);

        console.log('Cart Items:', cartItems);

        const reqTime = new Date();
        const formattedReqDate = reqTime.toLocaleDateString("en-IN", {
            timeZone: "Asia/Kolkata"
        });
        const formattedReqTime = reqTime.toLocaleTimeString("en-IN", {
            timeZone: "Asia/Kolkata",
            hour12: false
        });

        const reqDateTime = `${formattedReqDate}, ${formattedReqTime}`;

        reqTime.setMonth(reqTime.getMonth() + 1);
        const formattedExpDate = reqTime.toLocaleDateString("en-IN", {
            timeZone: "Asia/Kolkata"
        });


        document.getElementById('req_time').textContent = reqDateTime;
        document.getElementById('exp_time').textContent = formattedExpDate;
    }

    function dispaycard() {

        var main = document.getElementById('main');
        var dispaycard = document.getElementById('dispaycard');

        if (dispaycard.classList.contains('hidden')) {

            main.classList.add('hidden');
            dispaycard.classList.remove('hidden');

        } else {

            main.classList.remove('hidden');
            dispaycard.classList.add('hidden');
        }
    }


    function submitForm() {
        const reqTime = document.getElementById('req_time').textContent;
        const expTime = document.getElementById('exp_time').textContent;


        const cartItems = Object.values(params);

        const rollNo = document.getElementById('check_roll_no').value;
        const formData = {
            rollNo: rollNo,
            requestingDate: reqTime,
            // expiresDate: expTime,
            components: cartItems.map(item => ({
                productName: item.productName,
                quantity: item.quantity
            }))
        };

        console.log("Order Confirmation Details:", formData);

    }
</script>


<script>
    async function checkrollno() {
        const rollNo = document.getElementById('check_roll_no').value;
        console.log("Roll No:", rollNo);

        const errorDiv = document.getElementById('errorname');


        const userNameDiv = document.getElementById('userNameDiv');
        const userPhoneDiv = document.getElementById('userPhoneDiv');
        const userFacultyDiv = document.getElementById('userFacultyDiv');
        const acknowledgmentDiv = document.getElementById('acknowledgmentDiv');
        const saveButton = document.getElementById('saveButton');

        errorDiv.textContent = "";


        if (!rollNo || isNaN(rollNo.trim())) {
            errorDiv.textContent = "Please enter a valid roll number.";
            return;
        }


        userNameDiv.classList.add('hidden');
        userPhoneDiv.classList.add('hidden');
        userFacultyDiv.classList.add('hidden');
        acknowledgmentDiv.classList.add('hidden');
        saveButton.classList.add('hidden');

        try {
            const response = await fetch('http://localhost:3002/api/userpage/usercheck', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    roll_no: rollNo
                })
            });


            if (!response.ok) {
                const errorMessage = await response.text();
                throw new Error(`Error ${response.status}: ${errorMessage}`);
            }


            const data = await response.json();
            console.log('API Response:', data);


            if (!data.success) {
                errorDiv.textContent = data.message || "User not found";
            } else {

                document.getElementById('display_name').textContent = data.user.name;
                document.getElementById('display_roll_no').textContent = data.user.phone;
                document.getElementById('display_faculty').textContent = data.user.is_faculty === 1 ? 'Faculty' : 'Student';

                userNameDiv.classList.remove('hidden');
                userPhoneDiv.classList.remove('hidden');
                userFacultyDiv.classList.remove('hidden');
                acknowledgmentDiv.classList.remove('hidden');
                saveButton.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Error:', error);
            errorDiv.textContent = "User not found.";
        }
    }
</script>